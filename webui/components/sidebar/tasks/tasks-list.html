<html>
<head>
  <script type="module">
    import { store } from "/components/sidebar/tasks/tasks-store.js";
  </script>
</head>
<body>
  <div class="contents">
    <template x-if="$store.tasks">
      <div x-data class="contents">
        <h3 class="flex items-center justify-between px-2 py-2 text-xs font-semibold text-gray-500 uppercase cursor-pointer hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 border-t border-b border-gray-100 dark:border-gray-700/50" 
            data-bs-toggle="collapse"
            @click="$store.sidebar.toggleSection('tasks')"
            :class="{'text-gray-400': !$store.sidebar.isSectionOpen('tasks')}">
          TASKS
          <svg class="w-4 h-4 transition-transform duration-200" :class="{'rotate-180': $store.sidebar.isSectionOpen('tasks')}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 9l-7 7-7-7" />
          </svg>
        </h3>
        <div class="flex flex-col flex-1 min-h-0 transition-all duration-300 ease-in-out" 
             :class="{'hidden': !$store.sidebar.isSectionOpen('tasks')}"
             id="tasks-collapse">
          <div class="flex flex-col flex-1 min-h-0">
            <ul class="flex-1 overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]" x-show="$store.tasks.tasks.length > 0">
              <template x-for="task in $store.tasks.tasks" :key="task.id">
                <li>
                  <div class="relative flex flex-col w-full p-2 my-1 text-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700 transition-colors group"
                       :class="{'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300': task.id === $store.tasks.selected}"
                       @click="$store.tasks.selectTask(task.id)">
                    
                    <div class="flex items-center gap-2 mb-1">
                      <span class="w-2.5 h-2.5 rounded-full shrink-0"
                        :style="task.project?.color ? { backgroundColor: task.project.color } : { border: '1px solid currentColor' }"></span>
                      <span class="text-sm font-medium truncate"
                        :title="(task.task_name || `Task #${task.no}`)"
                        x-text="(task.task_name || `Task #${task.no}`)"
                        :data-task-id="task.id"></span>
                    </div>
                    
                    <div class="flex items-center justify-between">
                      <span class="px-2 py-0.5 text-[10px] font-medium rounded capitalize uppercase tracking-wider"
                            :class="{
                              'bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300': task.state === 'idle',
                              'bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300': task.state === 'running',
                              'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300': task.state === 'disabled',
                              'bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300': task.state === 'error'
                            }"
                            x-text="task.state || 'idle'"></span>
                            
                      <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button class="p-1 text-gray-400 rounded hover:text-blue-600 hover:bg-gray-200 dark:hover:bg-gray-600"
                                @click.stop="$store.tasks.openDetail(task.id)"
                                title="View task details">
                          <span class="material-symbols-outlined text-[16px]">info</span>
                        </button>
                        <button class="p-1 text-gray-400 rounded hover:text-yellow-600 hover:bg-gray-200 dark:hover:bg-gray-600"
                                title="Clear task chat"
                                @click.stop="$store.tasks.reset(task.id)">
                          <span class="material-symbols-outlined text-[16px]">restart_alt</span>
                        </button>
                        <button class="p-1 text-gray-400 rounded hover:text-red-600 hover:bg-gray-200 dark:hover:bg-gray-600"
                                title="Delete task" 
                                @click.stop="$store.tasks.deleteTask(task.id)">
                          <span class="material-symbols-outlined text-[16px]">delete</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </li>
              </template>
            </ul>
            <div class="flex items-center justify-center h-16 text-sm italic text-gray-500 dark:text-gray-400" x-show="$store.tasks.tasks.length === 0">
              <p>No tasks to list.</p>
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
</body>
</html>
