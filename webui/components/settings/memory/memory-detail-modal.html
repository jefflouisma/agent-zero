<html>
<head>
    <title>Memory Details</title>
</head>
<body>
    <div x-data class="h-full">
        <template x-if="$store.memoryDashboardStore && $store.memoryDashboardStore.detailMemory">
            <div class="flex flex-col h-full md:flex-row bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
                
                <!-- Main Content Section (Left on desktop, Top on mobile) -->
                <div class="flex-1 flex flex-col min-h-0 overflow-hidden order-2 md:order-1">
                    
                    <!-- Header Actions (Visible on Mobile) -->
                    <div class="md:hidden flex justify-end p-2 border-b border-gray-200 dark:border-gray-700">
                        <button class="p-2 text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 rounded-lg" @click="$store.memoryDashboardStore.closeMemoryDetails()">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>

                    <div class="flex-1 flex flex-col p-4 gap-4 overflow-y-auto">
                        <div class="flex flex-col flex-1 min-h-0">
                            <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Memory Content</h4>
                            <template x-if="!$store.memoryDashboardStore.editMode">
                                <div class="flex-1 p-4 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-y-auto font-mono text-sm leading-relaxed whitespace-pre-wrap break-words text-gray-800 dark:text-gray-200"
                                     x-text="$store.memoryDashboardStore.detailMemory?.content_full">
                                </div>
                            </template>
                            <template x-if="$store.memoryDashboardStore.editMode">
                                <textarea class="flex-1 p-4 bg-white dark:bg-gray-800 border border-blue-500 rounded-lg overflow-y-auto font-mono text-sm leading-relaxed resize-none focus:ring-2 focus:ring-blue-500 focus:outline-none dark:text-white"
                                          x-model="$store.memoryDashboardStore.detailMemory.content_full"></textarea>
                            </template>
                        </div>

                        <!-- Tags Section -->
                        <div x-show="$store.memoryDashboardStore.detailMemory?.tags && $store.memoryDashboardStore.detailMemory.tags.length > 0">
                            <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Tags</h4>
                            <div class="flex flex-wrap gap-2 p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg">
                                <template x-for="tag in $store.memoryDashboardStore.detailMemory?.tags || []" :key="tag">
                                    <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300 rounded-full" x-text="tag"></span>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Metadata Sidebar (Right on desktop, Bottom/Stacked on mobile) -->
                <div class="w-full md:w-80 bg-gray-50 dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 flex flex-col overflow-y-auto order-1 md:order-2 shrink-0">
                    
                    <!-- Header / Actions -->
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between sticky top-0 bg-gray-50 dark:bg-gray-800 z-10">
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 text-xs font-bold text-white rounded-md uppercase"
                                  :style="`background-color: ${$store.memoryDashboardStore.getAreaColor($store.memoryDashboardStore.detailMemory?.area)}`"
                                  x-text="$store.memoryDashboardStore.detailMemory?.area?.toUpperCase() || 'UNKNOWN'"></span>
                        </div>
                        
                        <div class="flex items-center gap-1">
                            <!-- View Mode Buttons -->
                            <template x-if="!$store.memoryDashboardStore.editMode">
                                <div class="flex gap-1">
                                    <button class="p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-400 dark:hover:text-blue-400 dark:hover:bg-gray-700 rounded transition-colors" 
                                            @click="$store.memoryDashboardStore.copyToClipboard($store.memoryDashboardStore.formatMemoryForCopy($store.memoryDashboardStore.detailMemory))"
                                            title="Copy All">
                                        <span class="material-symbols-outlined text-lg">copy_all</span>
                                    </button>
                                    <button class="p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:text-gray-400 dark:hover:text-blue-400 dark:hover:bg-gray-700 rounded transition-colors" 
                                            @click="$store.memoryDashboardStore.enableEditMode()"
                                            title="Edit">
                                        <span class="material-symbols-outlined text-lg">edit_document</span>
                                    </button>
                                    <button class="p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:text-gray-400 dark:hover:text-red-400 dark:hover:bg-gray-700 rounded transition-colors" 
                                            @click="$store.memoryDashboardStore.deleteMemory($store.memoryDashboardStore.detailMemory)"
                                            title="Delete">
                                        <span class="material-symbols-outlined text-lg">delete</span>
                                    </button>
                                </div>
                            </template>
                            <!-- Edit Mode Buttons -->
                            <template x-if="$store.memoryDashboardStore.editMode">
                                <div class="flex gap-1">
                                    <button class="p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:text-gray-400 dark:hover:text-red-400 dark:hover:bg-gray-700 rounded transition-colors" 
                                            @click="$store.memoryDashboardStore.cancelEditMode()"
                                            title="Cancel">
                                        <span class="material-symbols-outlined text-lg">close</span>
                                    </button>
                                    <button class="p-1.5 text-green-600 hover:bg-green-50 dark:text-green-400 dark:hover:bg-gray-700 rounded transition-colors" 
                                            @click="$store.memoryDashboardStore.confirmEditMode()"
                                            title="Save">
                                        <span class="material-symbols-outlined text-lg">check</span>
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Metadata Content -->
                    <div class="p-4 space-y-6">
                        <div>
                            <h5 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">General Info</h5>
                            <div class="space-y-3">
                                <div class="flex flex-col gap-1">
                                    <span class="text-xs text-gray-500 dark:text-gray-400 uppercase">ID</span>
                                    <span class="text-sm font-mono text-gray-700 dark:text-gray-300 break-all" x-text="$store.memoryDashboardStore.detailMemory?.id"></span>
                                </div>
                                <div class="flex flex-col gap-1">
                                    <span class="text-xs text-gray-500 dark:text-gray-400 uppercase">Timestamp</span>
                                    <span class="text-sm text-gray-700 dark:text-gray-300" x-text="$store.memoryDashboardStore.formatTimestamp($store.memoryDashboardStore.detailMemory?.timestamp, true)"></span>
                                </div>
                                <div class="flex flex-col gap-1">
                                    <span class="text-xs text-gray-500 dark:text-gray-400 uppercase">Source Type</span>
                                    <span class="text-sm font-medium px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 w-fit" 
                                          x-text="$store.memoryDashboardStore.detailMemory?.knowledge_source ? 'Knowledge' : 'Conversation'"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Knowledge Specific -->
                        <template x-if="$store.memoryDashboardStore.detailMemory?.knowledge_source">
                            <div>
                                <h5 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">Knowledge Source</h5>
                                <div class="p-3 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg">
                                    <div class="text-sm font-mono text-gray-700 dark:text-gray-300 break-all mb-2" x-text="$store.memoryDashboardStore.detailMemory.knowledge_source"></div>
                                    <button class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 flex items-center gap-1"
                                            @click="$store.memoryDashboardStore.openFile($store.memoryDashboardStore.detailMemory.knowledge_source)">
                                        <span class="material-symbols-outlined text-sm">open_in_new</span> Open File
                                    </button>
                                </div>
                            </div>
                        </template>

                        <!-- Conversation Specific -->
                        <template x-if="!$store.memoryDashboardStore.detailMemory?.knowledge_source">
                            <div>
                                <h5 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">Context</h5>
                                <div class="space-y-3">
                                    <div class="flex flex-col gap-1">
                                        <span class="text-xs text-gray-500 dark:text-gray-400 uppercase">Message ID</span>
                                        <span class="text-sm font-mono text-gray-700 dark:text-gray-300 break-all" x-text="$store.memoryDashboardStore.detailMemory?.message_id || 'N/A'"></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                </div>
            </div>
        </template>
    </div>
</body>

</html>
