<html>

<head>
    <title>Connection to A0 A2A Server</title>
</head>

<body>
    <div x-data>
        <p>Agent Zero A2A Server enables FastA2A protocol communication with other agents.</p>
        <p>Other agents can connect using the URL below (replace host if needed):</p>

        <!-- API Token Information -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 my-4 dark:bg-gray-800 dark:border-gray-700">
            <h4 class="m-0 mb-2 font-semibold text-gray-900 dark:text-white">API Token Information</h4>
            <p class="m-0 text-sm text-gray-600 dark:text-gray-400">
                The token used in the URL is automatically generated from your username and password.
                This same token is also used for external API endpoints. The token changes when you update your
                credentials.
            </p>
        </div>

        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">A2A Connection URL</h3>
        <div id="a2a-connection-example" class="w-full h-12 border rounded-lg border-gray-200 dark:border-gray-700 overflow-hidden"></div>

        <script>
            setTimeout(() => {
                const url = window.location.origin;
                // Try to get a2a_token first, fallback to mcp_server_token
                let tokenField = null;
                try {
                    const allFields = settingsModalProxy.settings.sections.flatMap(s => s.fields);
                    tokenField = allFields.find(f => f.id === 'a2a_token') || allFields.find(f => f.id === 'mcp_server_token');
                } catch (e) { }
                const token = tokenField ? tokenField.value : '';
                const connectionUrl = `${url}/a2a/t-${token}`;

                const editor = ace.edit("a2a-connection-example");
                const dark = localStorage.getItem("darkMode");
                editor.setTheme(dark !== "false" ? "ace/theme/github_dark" : "ace/theme/tomorrow");
                editor.session.setMode("ace/mode/text");
                editor.setValue(connectionUrl);
                editor.clearSelection();
                editor.setReadOnly(true);
            }, 0);
        </script>
    </div>

</body>

</html>