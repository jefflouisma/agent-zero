<html>

<head>
    <title>Agent Zero External API Examples</title>
</head>

<body>
    <div x-data>
        <p class="mb-4 text-gray-700 dark:text-gray-300">Agent Zero provides external API endpoints for integration with other applications.</p>
        <p class="mb-4 text-gray-700 dark:text-gray-300">These endpoints use API key authentication and support text messages and file attachments.</p>

        <!-- API Token Information -->
        <div class="p-4 mb-6 bg-gray-50 border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">API Token Information</h4>
            <p class="m-0 text-sm text-gray-500 dark:text-gray-400">
                The API token is automatically generated from your username and password.
                This same token is used for both MCP server connections and external API endpoints.
                The token changes when you update your credentials.
            </p>
        </div>

        <!-- Section 1: api_message Endpoint -->
        <div class="p-6 mb-6 border border-gray-200 rounded-lg dark:border-gray-700">
            <h2 class="pb-2 mb-4 text-xl font-bold border-b border-gray-200 text-gray-900 dark:text-white dark:border-gray-700">POST /api_message</h2>
            <p class="mb-4 text-sm text-gray-500 dark:text-gray-400">
                Send messages to Agent Zero and receive responses. Supports text messages, file attachments, and conversation continuity.
            </p>

            <!-- API Reference -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">API Reference</h3>
            <div class="p-4 mb-6 bg-gray-50 border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Parameters:</strong><br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">context_id</code> (string, optional): Existing chat context ID<br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">message</code> (string, required): The message to send<br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">attachments</code> (array, optional): Array of {filename, base64} objects<br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">lifetime_hours</code> (number, optional): Chat lifetime in hours (default: 24)
                </p>
                <p class="m-0 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Headers:</strong> <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">X-API-KEY</code> (required), <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">Content-Type: application/json</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">JavaScript Examples</h3>

            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">Basic Usage Example</h4>
            <div id="api-basic-example" class="w-full h-80 mb-6 rounded border border-gray-200 dark:border-gray-700"></div>

            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">Conversation Continuation Example</h4>
            <div id="api-continuation-example" class="w-full h-80 mb-6 rounded border border-gray-200 dark:border-gray-700"></div>

            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">File Attachment Example</h4>
            <div id="api-attachment-example" class="w-full h-80 mb-6 rounded border border-gray-200 dark:border-gray-700"></div>
        </div>

        <!-- Section 2: api_log_get Endpoint -->
        <div class="p-6 mb-6 border border-gray-200 rounded-lg dark:border-gray-700">
            <h2 class="pb-2 mb-4 text-xl font-bold border-b border-gray-200 text-gray-900 dark:text-white dark:border-gray-700">GET/POST /api_log_get</h2>
            <p class="mb-4 text-sm text-gray-500 dark:text-gray-400">
                Retrieve log data by context ID, limited to a specified number of entries from the newest.
            </p>

            <!-- API Reference -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">API Reference</h3>
            <div class="p-4 mb-6 bg-gray-50 border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Parameters:</strong><br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">context_id</code> (string, required): Context ID to get logs from<br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">length</code> (integer, optional): Number of log items to return from newest (default: 100)
                </p>
                <p class="m-0 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Headers:</strong> <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">X-API-KEY</code> (required), <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">Content-Type: application/json</code> (for POST)
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">JavaScript Examples</h3>

            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">GET Request Example</h4>
            <div id="api-log-get-example" class="w-full h-80 mb-6 rounded border border-gray-200 dark:border-gray-700"></div>

            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">POST Request Example</h4>
            <div id="api-log-post-example" class="w-full h-80 mb-6 rounded border border-gray-200 dark:border-gray-700"></div>
        </div>

        <!-- Section 3: api_terminate_chat Endpoint -->
        <div class="p-6 mb-6 border border-gray-200 rounded-lg dark:border-gray-700">
            <h2 class="pb-2 mb-4 text-xl font-bold border-b border-gray-200 text-gray-900 dark:text-white dark:border-gray-700">POST /api_terminate_chat</h2>
            <p class="mb-4 text-sm text-gray-500 dark:text-gray-400">
                Terminate and remove a chat context to free up resources. Similar to the MCP finish_chat function.
            </p>

            <!-- API Reference -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">API Reference</h3>
            <div class="p-4 mb-6 bg-gray-50 border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Parameters:</strong><br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">context_id</code> (string, required): Context ID of the chat to terminate
                </p>
                <p class="m-0 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Headers:</strong> <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">X-API-KEY</code> (required), <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">Content-Type: application/json</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">JavaScript Examples</h3>
            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">Basic Termination Examples</h4>
            <div id="api-terminate-example" class="w-full h-80 mb-6 rounded border border-gray-200 dark:border-gray-700"></div>
        </div>

        <!-- Section 4: api_reset_chat Endpoint -->
        <div class="p-6 mb-6 border border-gray-200 rounded-lg dark:border-gray-700">
            <h2 class="pb-2 mb-4 text-xl font-bold border-b border-gray-200 text-gray-900 dark:text-white dark:border-gray-700">POST /api_reset_chat</h2>
            <p class="mb-4 text-sm text-gray-500 dark:text-gray-400">
                Reset a chat context to clear conversation history while keeping the context_id alive for continued use.
            </p>

            <!-- API Reference -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">API Reference</h3>
            <div class="p-4 mb-6 bg-gray-50 border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Parameters:</strong><br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">context_id</code> (string, required): Context ID of the chat to reset
                </p>
                <p class="m-0 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Headers:</strong> <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">X-API-KEY</code> (required), <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">Content-Type: application/json</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">JavaScript Examples</h3>
            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">Basic Reset Examples</h4>
            <div id="api-reset-example" class="w-full h-80 mb-6 rounded border border-gray-200 dark:border-gray-700"></div>
        </div>

        <!-- Section 5: api_files_get Endpoint -->
        <div class="p-6 mb-6 border border-gray-200 rounded-lg dark:border-gray-700">
            <h2 class="pb-2 mb-4 text-xl font-bold border-b border-gray-200 text-gray-900 dark:text-white dark:border-gray-700">POST /api_files_get</h2>
            <p class="mb-4 text-sm text-gray-500 dark:text-gray-400">
                Retrieve file contents by paths, returning files as base64 encoded data. Useful for retrieving uploaded attachments.
            </p>

            <!-- API Reference -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">API Reference</h3>
            <div class="p-4 mb-6 bg-gray-50 border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Parameters:</strong><br>
                    • <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">paths</code> (array, required): Array of file paths to retrieve (e.g., ["/a0/tmp/uploads/file.txt"])
                </p>
                <p class="m-0 text-sm text-gray-500 dark:text-gray-400">
                    <strong class="text-gray-700 dark:text-gray-300">Headers:</strong> <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">X-API-KEY</code> (required), <code class="text-xs bg-gray-100 dark:bg-gray-900 p-0.5 rounded">Content-Type: application/json</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 class="mb-3 text-lg font-semibold text-gray-900 dark:text-white">JavaScript Examples</h3>
            <h4 class="mb-2 text-base font-bold text-gray-900 dark:text-white">File Retrieval Examples</h4>
            <div id="api-files-get-example" class="w-full h-80 mb-6 rounded border border-gray-200 dark:border-gray-700"></div>
        </div>

        <script>
            setTimeout(() => {
                const url = window.location.origin;
                const token = settingsModalProxy.settings.sections.filter(x => x.id == "mcp_server")[0].fields.filter(x => x.id == "mcp_server_token")[0].value;

                // Basic usage example
                const basicExample = `// Basic message example
async function sendMessage() {
    try {
        const response = await fetch('${url}/api_message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': '${token}'
            },
            body: JSON.stringify({
                message: "Hello, how can you help me?",
                lifetime_hours: 24
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Success!');
            console.log('Response:', data.response);
            console.log('Context ID:', data.context_id);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Call the function
sendMessage().then(result => {
    if (result) {
        console.log('Message sent successfully!');
    }
});`;

                                // Continuation example
                const continuationExample = `// Continue conversation example
async function continueConversation(contextId) {
    try {
        const response = await fetch('${url}/api_message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': '${token}'
            },
            body: JSON.stringify({
                context_id: contextId,
                message: "Can you tell me more about that?",
                lifetime_hours: 24
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Continuation Success!');
            console.log('Response:', data.response);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example: First send a message, then continue the conversation
async function fullConversationExample() {
    const firstResult = await sendMessage();
    if (firstResult && firstResult.context_id) {
        await continueConversation(firstResult.context_id);
    }
}

fullConversationExample();`;

                                // Attachment example
                const attachmentExample = `// File attachment example
async function sendWithAttachment() {
    try {
        // Example with text content (convert to base64)
        const textContent = "Hello World from attachment!";
        const base64Content = btoa(textContent);

        const response = await fetch('${url}/api_message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': '${token}'
            },
            body: JSON.stringify({
                message: "Please analyze this file:",
                attachments: [
                    {
                        filename: "document.txt",
                        base64: base64Content
                    }
                ],
                lifetime_hours: 12
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ File sent successfully!');
            console.log('Response:', data.response);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Call the function
sendWithAttachment();`;

                // Log GET example
                const logGetExample = `// Get logs using GET request
async function getLogsGET(contextId, length = 50) {
    try {
        const params = new URLSearchParams({
            context_id: contextId,
            length: length.toString()
        });

        const response = await fetch('${url}/api_log_get?' + params, {
            method: 'GET',
            headers: {
                'X-API-KEY': '${token}'
            }
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Logs retrieved successfully!');
            console.log('Total items:', data.log.total_items);
            console.log('Returned items:', data.log.returned_items);
            console.log('Log items:', data.log.items);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example usage
getLogsGET('ctx_abc123', 20);`;

                // Log POST example
                const logPostExample = `// Get logs using POST request
async function getLogsPOST(contextId, length = 50) {
    try {
        const response = await fetch('${url}/api_log_get', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': '${token}'
            },
            body: JSON.stringify({
                context_id: contextId,
                length: length
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Logs retrieved successfully!');
            console.log('Context ID:', data.context_id);
            console.log('Log GUID:', data.log.guid);
            console.log('Total items:', data.log.total_items);
            console.log('Returned items:', data.log.returned_items);
            console.log('Start position:', data.log.start_position);
            console.log('Progress:', data.log.progress);
            console.log('Log items:', data.log.items);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example usage - get latest 10 log entries
getLogsPOST('ctx_abc123', 10);`;

                                                // Terminate chat example
                const terminateExample = `// Basic terminate chat function
async function terminateChat(contextId) {
    try {
        const response = await fetch('${url}/api_terminate_chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': '${token}'
            },
            body: JSON.stringify({
                context_id: contextId
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Chat deleted successfully!');
            console.log('Message:', data.message);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example 1: Terminate a specific chat
terminateChat('ctx_abc123');

// Example 2: Complete workflow - send message, then terminate
async function simpleWorkflow() {
    // Send a message
    const result = await sendMessage();

    if (result && result.context_id) {
        console.log('Chat created:', result.context_id);

        // Do some work with the chat...
        // await continueConversation(result.context_id);

        // Clean up when done
        await terminateChat(result.context_id);
        console.log('Chat cleaned up');
    }
}

// Run the workflow
simpleWorkflow();`;

                // Reset chat example
                const resetExample = `// Basic reset chat function
async function resetChat(contextId) {
    try {
        const response = await fetch('${url}/api_reset_chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': '${token}'
            },
            body: JSON.stringify({
                context_id: contextId
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Chat reset successfully!');
            console.log('Message:', data.message);
            console.log('Context ID:', data.context_id);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example 1: Reset a specific chat
resetChat('ctx_abc123');

// Example 2: Reset and continue conversation
async function resetAndContinue() {
    const contextId = 'ctx_abc123';

    // Reset the chat to clear history
    const resetResult = await resetChat(contextId);

    if (resetResult) {
        console.log('Chat reset, starting fresh conversation...');

        // Continue with same context_id but fresh history
        const response = await fetch('${url}/api_message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': '${token}'
            },
            body: JSON.stringify({
                context_id: contextId,  // Same context ID
                message: "Hello, this is a fresh start!",
                lifetime_hours: 24
            })
        });

        const data = await response.json();
        console.log('New conversation started:', data.response);
    }
}

// Run the example
resetAndContinue();`;

                // Files get example
                const filesGetExample = `// Basic file retrieval
async function getFiles(filePaths) {
    try {
        const response = await fetch('${url}/api_files_get', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': '${token}'
            },
            body: JSON.stringify({
                paths: filePaths
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Files retrieved successfully!');
            console.log('Retrieved files:', Object.keys(data));

            // Convert base64 back to text for display
            for (const [filename, base64Content] of Object.entries(data)) {
                try {
                    const textContent = atob(base64Content);
                    console.log(\`\${filename}: \${textContent.substring(0, 100)}...\`);
                } catch (e) {
                    console.log(\`\${filename}: Binary file (\${base64Content.length} chars)\`);
                }
            }

            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example 1: Get specific files
const filePaths = [
    "/a0/tmp/uploads/document.txt",
    "/a0/tmp/uploads/data.json"
];
getFiles(filePaths);

// Example 2: Complete attachment workflow
async function attachmentWorkflow() {
    // Step 1: Send message with attachments
    const messageResponse = await fetch('${url}/api_message', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-API-KEY': '${token}'
        },
        body: JSON.stringify({
            message: "Please analyze this file",
            attachments: [{
                filename: "test.txt",
                base64: btoa("Hello, this is test content!")
            }],
            lifetime_hours: 1
        })
    });

    if (messageResponse.ok) {
        console.log('Message sent with attachment');

        // Step 2: Retrieve the uploaded file
        const retrievedFiles = await getFiles(["/a0/tmp/uploads/test.txt"]);

        if (retrievedFiles && retrievedFiles["test.txt"]) {
            const originalContent = atob(retrievedFiles["test.txt"]);
            console.log('Retrieved content:', originalContent);
        }
    }
}

// Run the complete workflow
attachmentWorkflow();`;

                // Initialize ACE editors
                const editors = [
                    { id: "api-basic-example", content: basicExample },
                    { id: "api-continuation-example", content: continuationExample },
                    { id: "api-attachment-example", content: attachmentExample },
                    { id: "api-log-get-example", content: logGetExample },
                    { id: "api-log-post-example", content: logPostExample },
                    { id: "api-terminate-example", content: terminateExample },
                    { id: "api-reset-example", content: resetExample },
                    { id: "api-files-get-example", content: filesGetExample }
                ];

                editors.forEach(({ id, content }) => {
                    const editor = ace.edit(id);
                    const dark = localStorage.getItem("darkMode");
                    if (dark != "false") {
                        editor.setTheme("ace/theme/github_dark");
                    } else {
                        editor.setTheme("ace/theme/tomorrow");
                    }
                    editor.session.setMode("ace/mode/javascript");
                    editor.setValue(content);
                    editor.clearSelection();
                    editor.setReadOnly(true);
                });
            }, 0);
        </script>
    </div>

</body>

</html>
