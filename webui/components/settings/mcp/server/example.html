<html>
<head>
    <title>Connection to A0 MCP Server</title>
</head>
<body>
    <div x-data class="flex flex-col h-full p-4 space-y-4">
        <div class="text-sm text-gray-600 dark:text-gray-400 space-y-2">
            <p>Agent Zero MCP Server is an SSE MCP running on the same URL and port as the Web UI + /mcp/sse or /mcp/http path.</p>
            <p>The same applies if you run A0 on a public URL using a tunnel.</p>
        </div>

        <!-- API Token Information -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 my-4 dark:bg-gray-800 dark:border-gray-700">
            <h4 class="m-0 mb-2 font-medium text-gray-900 dark:text-white">API Token Information</h4>
            <p class="m-0 text-sm text-gray-600 dark:text-gray-400">
                The token used in the URL is automatically generated from your username and password.
                This same token is also used for external API endpoints. The token changes when you update your credentials.
            </p>
        </div>

        <h3 class="text-lg font-medium text-gray-900 dark:text-white">Example MCP Server Configuration JSON</h3>
        <div id="mcp-server-example" class="w-full h-60 border rounded-lg border-gray-200 dark:border-gray-700"></div>

        <script>
            setTimeout(() => {
                const url = window.location.origin;
                // Safe access to settings
                let token = "TOKEN_NOT_FOUND";
                try {
                    if (settingsModalProxy && settingsModalProxy.settings) {
                        const section = settingsModalProxy.settings.sections.find(x => x.id == "mcp_server");
                        if (section) {
                            const field = section.fields.find(x => x.id == "mcp_server_token");
                            if (field) token = field.value;
                        }
                    }
                } catch (e) {
                    console.error("Error retrieving token for example:", e);
                }

                const jsonExample = JSON.stringify({
                    "mcpServers":
                    {
                        "agent-zero": {
                            "type": "sse",
                            "url": `${url}/mcp/t-${token}/sse`
                        },
                        "agent-zero-http": {
                            "type": "streamable-http",
                            "url": `${url}/mcp/t-${token}/http`
                        }
                    }
                }, null, 2);

                const editor = ace.edit("mcp-server-example");
                const dark = localStorage.getItem("darkMode");
                if (dark != "false") {
                    editor.setTheme("ace/theme/github_dark");
                } else {
                    editor.setTheme("ace/theme/tomorrow");
                }
                editor.session.setMode("ace/mode/json");
                editor.setValue(jsonExample);
                editor.clearSelection();
                editor.setReadOnly(true);
            }, 0);
        </script>
    </div>
</body>
</html>
